{
    # Global options
    admin off
    
    # Email for ACME/Let's Encrypt
    email germain85@hotmail.com
}

# =============================================================================
# ðŸ¥“ Main site â€” Station frontend
# =============================================================================
baconalgo.com, www.baconalgo.com {
    # Compression
    encode gzip zstd
    
    # API routes â†’ Rust backend
    handle /api/* {
        reverse_proxy backend:8080
    }
    
    # WebSocket â†’ Rust backend
    handle /ws/* {
        reverse_proxy backend:8080
    }
    
    # SSE â†’ Rust backend
    handle /sse/* {
        reverse_proxy backend:8080
    }
    
    # Everything else â†’ SvelteKit Station
    handle {
        reverse_proxy station:5173
    }
    
    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        Referrer-Policy strict-origin-when-cross-origin
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
    }
    
    # Cache static assets
    @static path *.js *.css *.png *.jpg *.svg *.woff2 *.ico
    header @static Cache-Control "public, max-age=31536000, immutable"
}

# =============================================================================
# ðŸ”§ Admin â€” only accessible via Tailscale or local
# =============================================================================
:8443 {
    reverse_proxy station:5173
    # Admin routes handled by SvelteKit route guards
}
